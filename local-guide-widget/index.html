<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Lovely Venice Apartments ‚Äì Local Guide</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  margin: 0;
  padding: 0;
  background: #ffffff;
  min-height: 100vh;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  color: #333;
  -webkit-font-smoothing: antialiased;
  line-height: 1.5;
}

#lv-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 24px 32px;
}

/* HEADER - Stile Lodgify elegante */
#lv-header {
  text-align: center;
  margin-bottom: 28px;
  padding: 28px 24px;
  background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.15);
}

#lv-header-title {
  font-size: 22px;
  font-weight: 700;
  color: #fff;
  margin-bottom: 8px;
  letter-spacing: -0.3px;
}

#lv-header-subtitle {
  font-size: 14px;
  color: rgba(255,255,255,0.7);
  font-weight: 400;
}

/* SELECT - Design moderno elegante */
#lv-menu-row {
  display: flex;
  gap: 12px;
  margin-bottom: 28px;
}

.lv-select-wrapper {
  flex: 1;
  position: relative;
}

.lv-select-wrapper::after {
  content: '';
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 6px solid #c0392b;
  pointer-events: none;
}

.lv-select {
  width: 100%;
  padding: 16px 44px 16px 18px;
  border-radius: 12px;
  border: 2px solid #e8e8e8;
  font-size: 15px;
  font-weight: 600;
  background: linear-gradient(to bottom, #fff 0%, #fafafa 100%);
  color: #333;
  cursor: pointer;
  appearance: none;
  transition: all 0.25s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.lv-select:hover {
  border-color: #ccc;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.lv-select:focus {
  outline: none;
  border-color: #c0392b;
  box-shadow: 0 0 0 4px rgba(192, 57, 43, 0.12), 0 4px 12px rgba(0,0,0,0.08);
}

.lv-lang-wrapper {
  position: relative;
}

.lv-lang-wrapper::after {
  content: '';
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 5px solid #c0392b;
  pointer-events: none;
}

.lv-lang {
  width: 72px;
  padding: 16px 28px 16px 14px;
  border-radius: 12px;
  border: 2px solid #e8e8e8;
  font-size: 14px;
  font-weight: 700;
  background: linear-gradient(to bottom, #fff 0%, #fafafa 100%);
  color: #333;
  cursor: pointer;
  appearance: none;
  transition: all 0.25s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.lv-lang:hover {
  border-color: #ccc;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.lv-lang:focus {
  outline: none;
  border-color: #c0392b;
  box-shadow: 0 0 0 4px rgba(192, 57, 43, 0.12);
}

/* SECTIONS */
.lv-section {
  margin-bottom: 32px;
}

.lv-section-title {
  font-size: 12px;
  font-weight: 700;
  color: #888;
  margin-bottom: 16px;
  text-transform: uppercase;
  letter-spacing: 1px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.lv-section-icon {
  font-size: 16px;
}

/* SUPERMARKET CARD - Verde elegante, cliccabile */
.lv-supermarket-card {
  background: #fff;
  border: 1px solid #e8e8e8;
  border-left: 4px solid #27ae60;
  border-radius: 12px;
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  transition: all 0.2s;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.lv-supermarket-card:hover {
  border-color: #27ae60;
  box-shadow: 0 4px 16px rgba(39, 174, 96, 0.15);
}

.lv-supermarket-icon {
  font-size: 32px;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  border-radius: 12px;
}

.lv-supermarket-info {
  flex: 1;
}

.lv-supermarket-name {
  font-size: 16px;
  font-weight: 600;
  color: #333;
  margin-bottom: 6px;
}

.lv-supermarket-distance {
  font-size: 13px;
  color: #666;
  display: flex;
  align-items: center;
  gap: 4px;
}

.lv-supermarket-distance::before {
  content: 'üö∂ ';
}

/* RESTAURANT LIST */
.lv-restaurant-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.lv-restaurant-card {
  background: #fff;
  border: 1px solid #e8e8e8;
  border-radius: 12px;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 14px;
  transition: all 0.2s;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.lv-restaurant-card:hover {
  border-color: #c0392b;
  box-shadow: 0 4px 16px rgba(192, 57, 43, 0.1);
}

.lv-restaurant-card.selected {
  border-color: #c0392b;
  border-width: 2px;
  background: linear-gradient(135deg, #fff5f5 0%, #fff 100%);
  box-shadow: 0 4px 16px rgba(192, 57, 43, 0.12);
}

.lv-restaurant-icon {
  font-size: 28px;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f8f8f8;
  border-radius: 10px;
}

.lv-restaurant-card.selected .lv-restaurant-icon {
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
}

.lv-restaurant-info {
  flex: 1;
  min-width: 0;
}

.lv-restaurant-name {
  font-size: 15px;
  font-weight: 600;
  color: #333;
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.lv-restaurant-card.selected .lv-restaurant-name {
  color: #c0392b;
}

.lv-restaurant-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.lv-restaurant-distance {
  font-size: 12px;
  color: #888;
  font-weight: 500;
}

.lv-restaurant-distance::before {
  content: 'üö∂ ';
  font-size: 11px;
}

.lv-restaurant-status {
  font-size: 10px;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.lv-status-open {
  background: #e8f5e9;
  color: #2e7d32;
}

.lv-status-closing {
  background: #fff3e0;
  color: #e65100;
  animation: pulse-warning 2s infinite;
}

.lv-status-closed {
  background: #ffebee;
  color: #c62828;
}

@keyframes pulse-warning {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* SHOPPING LIST */
.lv-shopping-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.lv-shopping-card {
  background: #fff;
  border: 1px solid #e8e8e8;
  border-radius: 12px;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 14px;
  transition: all 0.2s;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.lv-shopping-card:hover {
  border-color: #9b59b6;
  box-shadow: 0 4px 16px rgba(155, 89, 182, 0.1);
}

.lv-shopping-card.lv-outlet {
  border-left: 4px solid #e74c3c;
}

.lv-shopping-card.lv-outlet:hover {
  border-color: #e74c3c;
  box-shadow: 0 4px 16px rgba(231, 76, 60, 0.1);
}

.lv-shopping-card.lv-mall {
  border-left: 4px solid #9b59b6;
}

.lv-shopping-icon {
  font-size: 28px;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f8f8f8;
  border-radius: 10px;
}

.lv-shopping-info {
  flex: 1;
  min-width: 0;
}

.lv-shopping-name {
  font-size: 15px;
  font-weight: 600;
  color: #333;
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.lv-shopping-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
}

.lv-shopping-distance {
  font-size: 12px;
  color: #888;
  font-weight: 500;
}

.lv-shopping-distance::before {
  content: 'üöó ';
  font-size: 11px;
}

.lv-shopping-type {
  font-size: 10px;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.lv-type-outlet {
  background: #fdf2f2;
  color: #e74c3c;
}

.lv-type-mall {
  background: #f5f0f9;
  color: #9b59b6;
}

/* TRANSPORT INFO */
.lv-transport-info {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 4px;
  font-size: 11px;
  color: #888;
}

.lv-transport-badge {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  background: #f5f5f5;
  padding: 3px 8px;
  border-radius: 4px;
  font-weight: 500;
}

.lv-transport-badge.lv-bus {
  background: #e3f2fd;
  color: #1565c0;
}

.lv-transport-badge.lv-train {
  background: #fff3e0;
  color: #e65100;
}

/* MODAL POPUP */
.lv-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  padding: 20px;
}

.lv-modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.lv-modal {
  background: #fff;
  border-radius: 16px;
  max-width: 420px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  transform: scale(0.9) translateY(20px);
  transition: all 0.3s ease;
}

.lv-modal-overlay.active .lv-modal {
  transform: scale(1) translateY(0);
}

.lv-modal-header {
  padding: 20px 24px;
  border-bottom: 1px solid #eee;
  display: flex;
  align-items: center;
  gap: 14px;
}

.lv-modal-icon {
  font-size: 32px;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #f5f0f9 0%, #ede7f6 100%);
  border-radius: 12px;
}

.lv-modal-icon.outlet {
  background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
}

.lv-modal-title-wrap {
  flex: 1;
}

.lv-modal-title {
  font-size: 18px;
  font-weight: 700;
  color: #333;
  margin-bottom: 4px;
}

.lv-modal-subtitle {
  font-size: 13px;
  color: #888;
}

.lv-modal-close {
  position: absolute;
  top: 16px;
  right: 16px;
  width: 32px;
  height: 32px;
  border: none;
  background: #f5f5f5;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: #666;
  transition: all 0.2s;
}

.lv-modal-close:hover {
  background: #e0e0e0;
  color: #333;
}

.lv-modal-body {
  padding: 20px 24px;
}

.lv-transport-option {
  background: #f8f9fa;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 12px;
}

.lv-transport-option:last-child {
  margin-bottom: 0;
}

.lv-transport-option-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.lv-transport-option-icon {
  font-size: 24px;
}

.lv-transport-option-title {
  font-size: 15px;
  font-weight: 700;
  color: #333;
}

.lv-transport-option.bus .lv-transport-option-title {
  color: #1565c0;
}

.lv-transport-option.train .lv-transport-option-title {
  color: #e65100;
}

.lv-transport-option.car {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
}

.lv-transport-option.car .lv-transport-option-title {
  color: #2e7d32;
}

.lv-transport-option.car .lv-transport-option-header {
  margin-bottom: 8px;
}

.lv-car-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.lv-car-time {
  background: #2e7d32;
  color: #fff;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 700;
}

.lv-car-desc {
  font-size: 13px;
  color: #555;
}

.lv-transport-steps {
  list-style: none;
  padding: 0;
  margin: 0;
}

.lv-transport-step {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 8px 0;
  font-size: 13px;
  color: #555;
  border-bottom: 1px dashed #e0e0e0;
}

.lv-transport-step:last-child {
  border-bottom: none;
}

.lv-step-number {
  width: 22px;
  height: 22px;
  background: #e0e0e0;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 700;
  color: #666;
  flex-shrink: 0;
}

.lv-transport-option.bus .lv-step-number {
  background: #e3f2fd;
  color: #1565c0;
}

.lv-transport-option.train .lv-step-number {
  background: #fff3e0;
  color: #e65100;
}

.lv-modal-footer {
  padding: 16px 24px;
  border-top: 1px solid #eee;
  display: flex;
  gap: 12px;
}

.lv-modal-btn {
  flex: 1;
  padding: 14px 20px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  text-align: center;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.lv-modal-btn-secondary {
  background: #f5f5f5;
  border: none;
  color: #666;
}

.lv-modal-btn-secondary:hover {
  background: #e8e8e8;
}

.lv-modal-btn-primary {
  background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
  border: none;
  color: #fff;
}

.lv-modal-btn-primary:hover {
  background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
}

.lv-modal-btn-primary.outlet {
  background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
}

.lv-modal-btn-primary.outlet:hover {
  background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
}

/* FOOTER */
.lv-footer {
  text-align: center;
  padding-top: 20px;
  margin-top: 12px;
}

.lv-footer-text {
  font-size: 12px;
  color: #aaa;
  font-weight: 500;
}

/* DESKTOP - 2 columns for restaurants and shopping */
@media(min-width:768px){
  .lv-restaurant-list,
  .lv-shopping-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  #lv-header { padding: 32px; }
  #lv-header-title { font-size: 26px; }
  #lv-header-subtitle { font-size: 15px; }
  .lv-section-title { font-size: 13px; }
  .lv-restaurant-name { font-size: 16px; }
}

/* TABLET */
@media(max-width:767px) and (min-width:481px){
  #lv-container { padding: 20px 24px; }
  .lv-restaurant-list,
  .lv-shopping-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
  }
}

/* MOBILE */
@media(max-width:480px){
  #lv-container { padding: 16px 14px; }
  #lv-header { padding: 22px 18px; }
  #lv-header-title { font-size: 20px; }
  #lv-menu-row { flex-direction: column; gap: 10px; }
  .lv-lang-wrapper { align-self: flex-end; }
  .lv-lang { width: 80px; }
  .lv-supermarket-card { padding: 16px; flex-direction: column; text-align: center; }
  .lv-supermarket-icon { font-size: 28px; width: 48px; height: 48px; }
  .lv-supermarket-distance { justify-content: center; }
  .lv-transport-info { justify-content: center; flex-wrap: wrap; }
  .lv-restaurant-card,
  .lv-shopping-card { padding: 14px 12px; }
  .lv-restaurant-icon,
  .lv-shopping-icon { width: 42px; height: 42px; font-size: 24px; }
  .lv-restaurant-name,
  .lv-shopping-name { font-size: 14px; }
}
</style>
</head>
<body>

<div id="lv-container">

  <div id="lv-header">
    <div id="lv-header-title">üó∫Ô∏è Local Guide</div>
    <div id="lv-header-subtitle" data-i18n="subtitle">Supermercati e ristoranti vicino a te</div>
  </div>

  <div id="lv-menu-row">
    <div class="lv-select-wrapper">
      <select id="lv-apartment-select" class="lv-select">
        <option value="sweet">Sweet Dream Apartment</option>
        <option value="skyline">Skyline Apartment</option>
        <option value="dreamstudio">Dream Studio</option>
        <option value="station">Station Apartment</option>
      </select>
    </div>
    <div class="lv-lang-wrapper">
      <select id="lv-lang-select" class="lv-lang">
        <option value="it">üáÆüáπ</option>
        <option value="en">EN</option>
      </select>
    </div>
  </div>

  <!-- SUPERMARKET -->
  <div class="lv-section">
    <div class="lv-section-title">
      <span class="lv-section-icon">üõí</span>
      <span data-i18n="supermarketTitle">Supermercato pi√π vicino</span>
    </div>
    <div id="lv-supermarket-container"></div>
  </div>

  <!-- RESTAURANTS -->
  <div class="lv-section">
    <div class="lv-section-title">
      <span class="lv-section-icon">üçΩÔ∏è</span>
      <span data-i18n="restaurantsTitle">Ristoranti consigliati</span>
    </div>
    <div id="lv-restaurant-list" class="lv-restaurant-list"></div>
  </div>

  <!-- SHOPPING -->
  <div class="lv-section">
    <div class="lv-section-title">
      <span class="lv-section-icon">üõçÔ∏è</span>
      <span data-i18n="shoppingTitle">Shopping & Outlet</span>
    </div>
    <div id="lv-shopping-list" class="lv-shopping-list"></div>
  </div>

  <!-- FOOTER -->
  <div class="lv-footer">
    <div class="lv-footer-text">Lovely Venice Apartments ‚ù§Ô∏è</div>
  </div>

</div>

<!-- MODAL -->
<div id="lv-modal-overlay" class="lv-modal-overlay">
  <div class="lv-modal">
    <button class="lv-modal-close" onclick="closeModal()">‚úï</button>
    <div class="lv-modal-header">
      <div id="lv-modal-icon" class="lv-modal-icon">üè¨</div>
      <div class="lv-modal-title-wrap">
        <div id="lv-modal-title" class="lv-modal-title">Centro Commerciale</div>
        <div id="lv-modal-subtitle" class="lv-modal-subtitle">Come arrivare</div>
      </div>
    </div>
    <div id="lv-modal-body" class="lv-modal-body">
      <!-- Transport options will be inserted here -->
    </div>
    <div class="lv-modal-footer">
      <button class="lv-modal-btn lv-modal-btn-secondary" onclick="closeModal()" data-i18n-btn="close">Chiudi</button>
      <a id="lv-modal-maps-btn" href="#" target="_blank" rel="noopener" class="lv-modal-btn lv-modal-btn-primary">
        üìç <span data-i18n-btn="openMaps">Apri in Maps</span>
      </a>
    </div>
  </div>
</div>

<script>
let LANG = "it";

const I18N = {
  it: {
    subtitle: "Supermercati, ristoranti e shopping vicino a te",
    supermarketTitle: "Supermercato pi√π vicino",
    restaurantsTitle: "Ristoranti consigliati",
    shoppingTitle: "Shopping & Outlet",
    directions: "Indicazioni",
    open: "Aperto",
    closed: "Chiuso",
    closingSoon: "Chiude tra poco",
    walkMin: "min a piedi",
    driveMin: "min in auto",
    supermarket: "Supermercato",
    outlet: "Outlet",
    mall: "Centro Commerciale",
    busLine: "Bus",
    trainLine: "Treno",
    fromStation: "da Mestre FS"
  },
  en: {
    subtitle: "Supermarkets, restaurants and shopping near you",
    supermarketTitle: "Nearest supermarket",
    restaurantsTitle: "Recommended restaurants",
    shoppingTitle: "Shopping & Outlet",
    directions: "Directions",
    open: "Open",
    closed: "Closed",
    closingSoon: "Closing soon",
    walkMin: "min walk",
    driveMin: "min drive",
    supermarket: "Supermarket",
    outlet: "Outlet",
    mall: "Shopping Mall",
    busLine: "Bus",
    trainLine: "Train",
    fromStation: "from Mestre FS"
  }
};

// Supermarket data per apartment
const SUPERMARKETS = {
  sweet: {
    name: "Supermercato",
    distance: 5,
    link: "https://www.google.com/maps/dir/Via+Caposile,+4,+30171+Venezia+VE/Via+Piave,+172,+30171+Venezia+VE"
  },
  skyline: {
    name: "Supermercato",
    distance: 4,
    link: "https://www.google.com/maps/dir/Via+Felisati,+167,+30171+Venezia+VE/Via+Piave,+172,+30171+Venezia+VE"
  },
  dreamstudio: {
    name: "Supermercato",
    distance: 4,
    links: [
      { name: "Supermercato 1", link: "https://www.google.com/maps/dir/Via+Alfredo+Catalani,+11,+30171+Venezia+VE/Via+Miranese,+86,+30171+Venezia+VE" },
      { name: "Supermercato 2", link: "https://www.google.com/maps/dir/Via+Alfredo+Catalani,+11,+30171+Venezia+VE/Via+Monte+Nero,+84,+30171+Venezia+VE" }
    ]
  },
  station: {
    name: "Supermercato",
    distance: 7,
    link: "https://www.google.com/maps/dir/Via+C%C3%A0+Marcello,+9,+30172+Venezia+VE/Corso+del+Popolo,+225,+30172+Venezia+VE"
  }
};

// Restaurant data with opening hours and distance per apartment
const RESTAURANTS = [
  {
    name: "Macch√©pasta",
    icon: "üçù",
    link: "https://www.google.com/maps?um=1&ie=UTF-8&fb=1&gl=it&sa=X&geocode=KR8b6kAptX5HMbiNV_xLWvq-&daddr=Via+Cappuccina,+169,+30172+Venezia+VE",
    // 12-23 tutti i giorni
    getHours: function(day) {
      return { open: 12, close: 23 };
    },
    distance: { sweet: 6, skyline: 5, dreamstudio: 12, station: 8 }
  },
  {
    name: "Ristorante Pizzeria Da Michele",
    icon: "üçï",
    link: "https://www.google.com/maps?hl=it&gl=it&um=1&ie=UTF-8&fb=1&sa=X&geocode=KXVIEQ8jtH5HMYXL8drGJI4m&daddr=Via+Cappuccina,+177,+30172+Venezia+VE",
    // Lun-Gio: 09:30-23:30, Ven-Dom: 09-00
    getHours: function(day) {
      if (day >= 5 || day === 0) return { open: 9, close: 24 }; // Ven-Dom
      return { open: 9.5, close: 23.5 }; // Lun-Gio
    },
    distance: { sweet: 6, skyline: 5, dreamstudio: 12, station: 8 }
  },
  {
    name: "Antica Focacceria Fiorentina",
    icon: "ü•ñ",
    link: "https://www.google.com/maps?hl=it&gl=it&um=1&ie=UTF-8&fb=1&sa=X&geocode=Ke-2R6BNtX5HMdNiv2XLYxFR&daddr=Via+Ca%27+Marcello,+8,+30172+Venezia+VE",
    // 07:30-15, 17:30-22:30 tutti i giorni
    getHours: function(day) {
      return { open: 7.5, close: 15, open2: 17.5, close2: 22.5 };
    },
    distance: { sweet: 10, skyline: 8, dreamstudio: 15, station: 1 }
  },
  {
    name: "Hostaria Vite Rossa",
    icon: "üç∑",
    link: "https://www.google.com/maps?um=1&ie=UTF-8&fb=1&gl=it&sa=X&geocode=KTvB6t8XtH5HMc-T-ENdeKls&daddr=Via+Pietro+Bembo,+30,+30172+Venezia+VE",
    // Lun-Mar: 09-15:30, Mer-Sab: 09-15:30 + 17:30-23, Dom: 09-15:30
    getHours: function(day) {
      if (day >= 3 && day <= 6) return { open: 9, close: 15.5, open2: 17.5, close2: 23 }; // Mer-Sab
      return { open: 9, close: 15.5 }; // Lun-Mar, Dom
    },
    distance: { sweet: 8, skyline: 6, dreamstudio: 14, station: 5 }
  },
  {
    name: "BEFED Brew Pub Mestre",
    icon: "üç∫",
    link: "https://www.google.com/maps?um=1&ie=UTF-8&fb=1&gl=it&sa=X&geocode=KYW5j8XfyX5HMajCepcBhMHG&daddr=Vle+Ancona,+20,+30172+Venezia+VE",
    // Lun: 19-00, Mar-Gio: 12-14:30 + 19-00, Ven: 12-14:30 + 19-01, Sab: 18:30-01, Dom: 18:30-00
    getHours: function(day) {
      if (day === 1) return { open: 19, close: 24 }; // Lun
      if (day >= 2 && day <= 4) return { open: 12, close: 14.5, open2: 19, close2: 24 }; // Mar-Gio
      if (day === 5) return { open: 12, close: 14.5, open2: 19, close2: 25 }; // Ven (01:00)
      if (day === 6) return { open: 18.5, close: 25 }; // Sab
      return { open: 18.5, close: 24 }; // Dom
    },
    distance: { sweet: 12, skyline: 10, dreamstudio: 18, station: 10 }
  },
  {
    name: "Tacos Di Paris TURKISH Grill",
    icon: "üåÆ",
    link: "https://www.google.com/maps?um=1&ie=UTF-8&fb=1&gl=it&sa=X&geocode=KYt7eaLEtX5HMd6Un2ZdFSF4&daddr=Via+Miranese,+82,+30171+Venezia+VE",
    // 12-23, Dom: 12-22:45
    getHours: function(day) {
      if (day === 0) return { open: 12, close: 22.75 }; // Dom
      return { open: 12, close: 23 };
    },
    distance: { sweet: 10, skyline: 12, dreamstudio: 3, station: 12 }
  },
  {
    name: "Panda Fly",
    icon: "ü•°",
    link: "https://www.google.com/maps/dir//Via+Piave,+138,+30171+Venezia+VE/@45.5007445,12.2598608,15z",
    // 12-23, chiuso mercoled√¨
    getHours: function(day) {
      if (day === 3) return null; // Chiuso mercoled√¨
      return { open: 12, close: 23 };
    },
    distance: { sweet: 2, skyline: 3, dreamstudio: 8, station: 6 }
  }
];

// Apartment coordinates for dynamic directions
const APT_COORDS = {
  sweet: "45.4853,12.2345", // Via Caposile 4
  skyline: "45.4889,12.2412", // Via Felisati 167
  dreamstudio: "45.4921,12.2198", // Via Alfredo Catalani 11
  station: "45.4827,12.2398" // Via C√† Marcello 9
};

// Shopping centers and outlet data with detailed directions
const SHOPPING = [
  {
    name: "Noventa Designer Outlet",
    icon: "üëú",
    type: "outlet",
    address: "Via Marco Polo, 1, 30020 Noventa di Piave VE",
    coords: "45.6636,12.5311",
    distance: { sweet: 30, skyline: 30, dreamstudio: 32, station: 28 },
    transport: { bus: "ATVO", train: "Noventa-Montebuna" },
    directions: {
      it: {
        bus: {
          title: "Bus ATVO diretto",
          steps: [
            "Vai alla Stazione di Mestre (10 min a piedi)",
            "Prendi il bus ATVO linea Venezia-Noventa Outlet",
            "Scendi alla fermata 'Noventa Designer Outlet'",
            "Durata: circa 40 minuti"
          ]
        },
        train: {
          title: "Treno + Navetta",
          steps: [
            "Dalla Stazione di Mestre prendi il treno direzione Trieste/Udine",
            "Scendi alla fermata 'Noventa di Piave-Montebuna'",
            "Prendi la navetta gratuita per l'Outlet (ogni 30 min)",
            "Durata totale: circa 35-45 minuti"
          ]
        }
      },
      en: {
        bus: {
          title: "Direct ATVO Bus",
          steps: [
            "Walk to Mestre Train Station (10 min walk)",
            "Take ATVO bus line Venice-Noventa Outlet",
            "Get off at 'Noventa Designer Outlet' stop",
            "Duration: about 40 minutes"
          ]
        },
        train: {
          title: "Train + Shuttle",
          steps: [
            "From Mestre Station take train to Trieste/Udine",
            "Get off at 'Noventa di Piave-Montebuna'",
            "Take free shuttle to Outlet (every 30 min)",
            "Total duration: about 35-45 minutes"
          ]
        }
      }
    }
  },
  {
    name: "Centro Commerciale Nave de Vero",
    icon: "üè¨",
    type: "mall",
    address: "Via Martiri della Libert√†, 1, 30175 Marghera VE",
    coords: "45.4595,12.2219",
    distance: { sweet: 8, skyline: 10, dreamstudio: 6, station: 10 },
    transport: { bus: "6" },
    directions: {
      it: {
        bus: {
          title: "Bus linea 6",
          steps: [
            "Raggiungi la fermata bus pi√π vicina (Via Piave o Stazione)",
            "Prendi il bus linea 6 direzione Marghera",
            "Scendi alla fermata 'Nave de Vero'",
            "Durata: circa 15-20 minuti"
          ]
        }
      },
      en: {
        bus: {
          title: "Bus line 6",
          steps: [
            "Reach the nearest bus stop (Via Piave or Station)",
            "Take bus line 6 direction Marghera",
            "Get off at 'Nave de Vero' stop",
            "Duration: about 15-20 minutes"
          ]
        }
      }
    }
  },
  {
    name: "Centro Commerciale Le Barche",
    icon: "üõí",
    type: "mall",
    address: "Via Forte Marghera, 163, 30173 Venezia VE",
    coords: "45.4886,12.2358",
    distance: { sweet: 5, skyline: 4, dreamstudio: 8, station: 6 },
    transport: { bus: "2, 7" },
    directions: {
      it: {
        bus: {
          title: "Bus linea 2 o 7",
          steps: [
            "Raggiungi la fermata bus in Via Piave",
            "Prendi il bus linea 2 o 7",
            "Scendi alla fermata 'Le Barche'",
            "Durata: circa 10 minuti"
          ]
        }
      },
      en: {
        bus: {
          title: "Bus line 2 or 7",
          steps: [
            "Reach the bus stop on Via Piave",
            "Take bus line 2 or 7",
            "Get off at 'Le Barche' stop",
            "Duration: about 10 minutes"
          ]
        }
      }
    }
  },
  {
    name: "Valecenter",
    icon: "üè™",
    type: "mall",
    address: "Via Enrico Mattei, 1, 30020 Marcon VE",
    coords: "45.5502,12.3041",
    distance: { sweet: 15, skyline: 14, dreamstudio: 18, station: 12 },
    transport: { bus: "45E" },
    directions: {
      it: {
        bus: {
          title: "Bus linea 45E",
          steps: [
            "Vai alla Stazione di Mestre",
            "Prendi il bus linea 45E direzione Marcon",
            "Scendi alla fermata 'Valecenter'",
            "Durata: circa 25-30 minuti"
          ]
        }
      },
      en: {
        bus: {
          title: "Bus line 45E",
          steps: [
            "Go to Mestre Train Station",
            "Take bus line 45E direction Marcon",
            "Get off at 'Valecenter' stop",
            "Duration: about 25-30 minutes"
          ]
        }
      }
    }
  }
];

// Modal functions
let currentShopLink = '';

function openModal(shopIdx) {
  const shop = SHOPPING[shopIdx];
  const apt = document.getElementById("lv-apartment-select").value;
  const L = I18N[LANG];
  const directions = shop.directions[LANG];
  const carDistance = shop.distance[apt];
  
  // Set modal content
  document.getElementById('lv-modal-icon').textContent = shop.icon;
  document.getElementById('lv-modal-icon').className = 'lv-modal-icon' + (shop.type === 'outlet' ? ' outlet' : '');
  document.getElementById('lv-modal-title').textContent = shop.name;
  document.getElementById('lv-modal-subtitle').textContent = LANG === 'it' ? 'Come arrivare' : 'How to get there';
  
  // Build transport options HTML
  let bodyHTML = '';
  
  // Car option first
  const carTitle = LANG === 'it' ? 'In auto' : 'By car';
  const carText = LANG === 'it' ? `Circa ${carDistance} minuti in auto dall'appartamento` : `About ${carDistance} minutes by car from the apartment`;
  bodyHTML += `
    <div class="lv-transport-option car">
      <div class="lv-transport-option-header">
        <span class="lv-transport-option-icon">üöó</span>
        <span class="lv-transport-option-title">${carTitle}</span>
      </div>
      <div class="lv-car-info">
        <span class="lv-car-time">~${carDistance} min</span>
        <span class="lv-car-desc">${carText}</span>
      </div>
    </div>
  `;
  
  if (directions.bus) {
    bodyHTML += `
      <div class="lv-transport-option bus">
        <div class="lv-transport-option-header">
          <span class="lv-transport-option-icon">üöå</span>
          <span class="lv-transport-option-title">${directions.bus.title}</span>
        </div>
        <ul class="lv-transport-steps">
          ${directions.bus.steps.map((step, i) => `
            <li class="lv-transport-step">
              <span class="lv-step-number">${i + 1}</span>
              <span>${step}</span>
            </li>
          `).join('')}
        </ul>
      </div>
    `;
  }
  
  if (directions.train) {
    bodyHTML += `
      <div class="lv-transport-option train">
        <div class="lv-transport-option-header">
          <span class="lv-transport-option-icon">üöÜ</span>
          <span class="lv-transport-option-title">${directions.train.title}</span>
        </div>
        <ul class="lv-transport-steps">
          ${directions.train.steps.map((step, i) => `
            <li class="lv-transport-step">
              <span class="lv-step-number">${i + 1}</span>
              <span>${step}</span>
            </li>
          `).join('')}
        </ul>
      </div>
    `;
  }
  
  document.getElementById('lv-modal-body').innerHTML = bodyHTML;
  
  // Set Maps button
  currentShopLink = getShoppingLink(shop, apt);
  const mapsBtn = document.getElementById('lv-modal-maps-btn');
  mapsBtn.href = currentShopLink;
  mapsBtn.className = 'lv-modal-btn lv-modal-btn-primary' + (shop.type === 'outlet' ? ' outlet' : '');
  
  // Update button texts
  document.querySelector('[data-i18n-btn="close"]').textContent = LANG === 'it' ? 'Chiudi' : 'Close';
  document.querySelector('[data-i18n-btn="openMaps"]').textContent = LANG === 'it' ? 'Apri in Maps' : 'Open in Maps';
  
  // Show modal
  document.getElementById('lv-modal-overlay').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('lv-modal-overlay').classList.remove('active');
  document.body.style.overflow = '';
}

// Close modal on overlay click
document.getElementById('lv-modal-overlay').addEventListener('click', function(e) {
  if (e.target === this) {
    closeModal();
  }
});

// Close modal on Escape key
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeModal();
  }
});

function getShoppingLink(shop, apt) {
  const aptCoord = APT_COORDS[apt];
  return `https://www.google.com/maps/dir/${aptCoord}/${encodeURIComponent(shop.address)}`;
}

function getStatus(restaurant) {
  const now = new Date();
  const day = now.getDay(); // 0=Dom, 1=Lun, etc.
  const currentHour = now.getHours();
  const currentMin = now.getMinutes();
  const currentTime = currentHour + currentMin / 60;
  
  const L = I18N[LANG];
  const hours = restaurant.getHours(day);
  
  // Chiuso oggi
  if (!hours) {
    return { status: "closed", text: L.closed };
  }
  
  // Controlla primo turno
  if (currentTime >= hours.open && currentTime < hours.close) {
    const timeUntilClose = hours.close - currentTime;
    if (timeUntilClose <= 1) {
      return { status: "closing", text: L.closingSoon };
    }
    return { status: "open", text: L.open };
  }
  
  // Controlla secondo turno se esiste
  if (hours.open2 && hours.close2) {
    if (currentTime >= hours.open2 && currentTime < hours.close2) {
      const timeUntilClose = hours.close2 - currentTime;
      if (timeUntilClose <= 1) {
        return { status: "closing", text: L.closingSoon };
      }
      return { status: "open", text: L.open };
    }
  }
  
  return { status: "closed", text: L.closed };
}

function renderWidget() {
  const L = I18N[LANG];
  const apt = document.getElementById("lv-apartment-select").value;
  
  // Update translations
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (L[key]) el.innerText = L[key];
  });
  
  // Render supermarket
  const supermarket = SUPERMARKETS[apt];
  const supermarketContainer = document.getElementById("lv-supermarket-container");
  
  if (supermarket.links) {
    // Multiple supermarkets (Dream Studio)
    supermarketContainer.innerHTML = supermarket.links.map((s, i) => `
      <a href="${s.link}" target="_blank" rel="noopener" class="lv-supermarket-card" style="margin-bottom: ${i < supermarket.links.length - 1 ? '12px' : '0'}">
        <div class="lv-supermarket-icon">üõí</div>
        <div class="lv-supermarket-info">
          <div class="lv-supermarket-name">${L.supermarket} ${i + 1}</div>
          <div class="lv-supermarket-distance">~${supermarket.distance + i} ${L.walkMin}</div>
        </div>
      </a>
    `).join('');
  } else {
    supermarketContainer.innerHTML = `
      <a href="${supermarket.link}" target="_blank" rel="noopener" class="lv-supermarket-card">
        <div class="lv-supermarket-icon">üõí</div>
        <div class="lv-supermarket-info">
          <div class="lv-supermarket-name">${L.supermarket}</div>
          <div class="lv-supermarket-distance">~${supermarket.distance} ${L.walkMin}</div>
        </div>
      </a>
    `;
  }
  
  // Sort restaurants by distance
  const sortedRestaurants = [...RESTAURANTS].sort((a, b) => 
    a.distance[apt] - b.distance[apt]
  );
  
  // Render restaurants
  const restaurantList = document.getElementById("lv-restaurant-list");
  restaurantList.innerHTML = sortedRestaurants.map((r, idx) => {
    const status = getStatus(r);
    const statusClass = status.status === "open" ? "lv-status-open" : 
                        status.status === "closing" ? "lv-status-closing" : "lv-status-closed";
    
    return `
      <a href="${r.link}" target="_blank" rel="noopener" class="lv-restaurant-card" data-idx="${idx}">
        <div class="lv-restaurant-icon">${r.icon}</div>
        <div class="lv-restaurant-info">
          <div class="lv-restaurant-name">${r.name}</div>
          <div class="lv-restaurant-meta">
            <span class="lv-restaurant-distance">~${r.distance[apt]} ${L.walkMin}</span>
            <span class="lv-restaurant-status ${statusClass}">${status.text}</span>
          </div>
        </div>
      </a>
    `;
  }).join('');
  
  // Sort shopping by distance
  const sortedShopping = [...SHOPPING].sort((a, b) => 
    a.distance[apt] - b.distance[apt]
  );
  
  // Render shopping
  const shoppingList = document.getElementById("lv-shopping-list");
  shoppingList.innerHTML = sortedShopping.map((s, idx) => {
    const typeClass = s.type === "outlet" ? "lv-type-outlet" : "lv-type-mall";
    const cardClass = s.type === "outlet" ? "lv-outlet" : "lv-mall";
    const typeText = s.type === "outlet" ? L.outlet : L.mall;
    const originalIdx = SHOPPING.indexOf(s); // Get original index for modal
    
    // Build transport info
    let transportHTML = '';
    if (s.transport) {
      transportHTML = '<div class="lv-transport-info">';
      if (s.transport.bus) {
        transportHTML += `<span class="lv-transport-badge lv-bus">üöå ${L.busLine} ${s.transport.bus}</span>`;
      }
      if (s.transport.train) {
        transportHTML += `<span class="lv-transport-badge lv-train">üöÜ ${s.transport.train}</span>`;
      }
      transportHTML += '</div>';
    }
    
    return `
      <div class="lv-shopping-card ${cardClass}" onclick="openModal(${originalIdx})" data-idx="${originalIdx}">
        <div class="lv-shopping-icon">${s.icon}</div>
        <div class="lv-shopping-info">
          <div class="lv-shopping-name">${s.name}</div>
          <div class="lv-shopping-meta">
            <span class="lv-shopping-distance">~${s.distance[apt]} ${L.driveMin}</span>
            <span class="lv-shopping-type ${typeClass}">${typeText}</span>
          </div>
          ${transportHTML}
        </div>
      </div>
    `;
  }).join('');
}

// Events
document.getElementById("lv-lang-select").addEventListener("change", e => {
  LANG = e.target.value;
  renderWidget();
});

document.getElementById("lv-apartment-select").addEventListener("change", renderWidget);

// Init
renderWidget();

// Update status every minute
setInterval(renderWidget, 60000);
</script>

</body>
</html>
